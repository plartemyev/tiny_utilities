# Errors get logged to /var/log/cfn-init.log. See Also /var/log/eb-tools.log

files:
  "/etc/php.d/redis.ini" :
    mode: "000644"
    owner: root
    group: root
    content: |
      extension=redis.so
      session.save_handler = redis
      session.save_path = "tcp://sessionstore.wo5usz.0001.usw2.cache.amazonaws.com:6379"
    test: '[ ! /etc/php.d/redis.ini ] && echo "Redis connection not configured" >> /var/log/eb-activity.log'

packages:
  yum:
    php56-devel: []
    make: []
    gcc: []
    git: []

commands:
  01download_redis:
    command: "wget https://github.com/nicolasff/phpredis/zipball/master -O phpredis.zip"
    cwd: /tmp
    test: '[ ! /tmp/phpredis.zip ] && echo "Redis not downloaded" >> /var/log/eb-activity.log'

  02install_redis:
    command: "unzip -o /tmp/phpredis.zip && cd /tmp/phpredis-phpredis-* && phpize && ./configure && make && make install"
    cwd: /tmp

  03restart_server:
    command: "apachectl restart"
    cwd: /tmp
